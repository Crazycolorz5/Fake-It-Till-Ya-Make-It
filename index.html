<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

<title>Fake It Till Ya Make It</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    padding: 10px;
    background: #364e6f;
    font-family: Arial;
}


#main_container {
    margin-left: auto;
    margin-right: auto;
    width: 100%;
    max-width: 1000px;
}

.title {
    text-align: center;
    font-family: Verdana;
    font-size: 28px;
    color: #fff;
    margin: 20px 0 30px;
    text-shadow: 2px 2px 7px rgba(0, 0, 0, 0.5);
}

#btn_connect {
    display: block;
    width: 40%;
    height: 28px;
    margin-top: 50px;
    margin-left: auto;
    margin-right: auto;
    font-size: 16px;
    border: 1px solid #888;
    border-radius: 4px;
    outline: none;
    box-shadow: 2px 2px 7px rgba(0, 0, 0, 0.5);
    background: #fff;
}

#btn_connect:hover {
    background: #eee;
    cursor: pointer;
}

#btn_connect:active {
    background: #ccc;
}


#div_output {
    margin-top: 10px;
    border: 1px solid #ccc;
    width: 100%;
    height: 60%;
    max-height: 600px;
    font-size: 20px;
    overflow-y: auto;
    border-radius: 4px;
    padding: 2px 5px;
    box-shadow: 2px 2px 7px rgba(0, 0, 0, 0.5);
    background: #fff;
}

#input_user {
    margin-top: 10px;
    width: 100%;
    font-size: 20px;
    border-radius: 4px;
    border: 1px solid #999;
    outline: none;
    padding: 2px 5px;
    box-shadow: 2px 2px 7px rgba(0, 0, 0, 0.5);
    background: #fff;
}

</style>


<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

<script>
var ws = null


function formatResponse(text) {
    var lines = text.split("\n")
    var result = []

    for (var i in lines) {
        result.push("<p>")
        result.push(lines[i])
        result.push("</p>")
    }
    
    return result.join("")
}


$(document).ready(function() {
    var history = []
    var historyIndex = 0

    //$("#btn_connect").hide()
    $("#div_output").hide()
    $("#input_user").hide()

    $("#btn_connect").click(function() {
        ws = new WebSocket("ws://localhost:10000")

        ws.onopen = function(e) {
            $("#div_output").html("")
            $("#div_output").show()
            $("#input_user").show()
        }

        ws.onmessage = function(e) {
            $("#div_output").html($("#div_output").html() + formatResponse(e.data) + "<br />")
            $("#div_output").animate({scrollTop: $('#div_output').prop("scrollHeight")}, 300)
        }

        ws.onerror = function(e) {
            ws = null
            $("#btn_connect").show()
            $("#div_output").hide()
            $("#input_user").hide()
        }

        ws.onclose = ws.onerror

        $("#btn_connect").hide()
    })


    $("#input_user").keydown(function(e) {
        if (38 == e.keyCode) {          // up
            if (historyIndex >= 1)
                historyIndex--;

            if (historyIndex < history.length)
                $("#input_user").val(history[historyIndex])
        } else if (40 == e.keyCode) {   // down
            if (historyIndex <= history.length - 1)
                historyIndex++;

            if (historyIndex < history.length)
                $("#input_user").val(history[historyIndex])
            else
                $("#input_user").val("")
        }

        if (!ws)
            return

        if (13 == e.keyCode) {          // enter
            input = $("#input_user").val()
            $("#input_user").val("")

            ws.send(input)

            history.push(input)
            historyIndex = history.length

            last = $("#div_output p").last()
            last.html(last.html() + input)
        }
    })
})

</script>

</head>

<body>

<div id="main_container">
    <div class="title">Fake It Till Ya Make It</div>
    <button id="btn_connect">Start</button>
    <div id="div_output"></div>
    <input type="text" id="input_user" />
</div>

</body>
</html>
